<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì± ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .main-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Employee Cards with Boxes */
        .employee-cards-section {
            margin-top: 30px;
        }

        .employee-card-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            position: relative;
        }

        .card-badge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .info-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border-left: 4px solid;
        }

        .info-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .info-item.box-no {
            border-left-color: #667eea;
            background: linear-gradient(135deg, #ffffff 0%, #e3f2fd 100%);
        }

        .info-item.box-empid {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #ffffff 0%, #d1fae5 100%);
        }

        .info-item.box-badid {
            border-left-color: #ec4899;
            background: linear-gradient(135deg, #ffffff 0%, #fce7f3 100%);
        }

        .info-item.box-name {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #ffffff 0%, #fef3c7 100%);
        }

        .info-item.box-batch {
            border-left-color: #06b6d4;
            background: linear-gradient(135deg, #ffffff 0%, #cffafe 100%);
        }

        .info-item.box-phone {
            border-left-color: #8b5cf6;
            background: linear-gradient(135deg, #ffffff 0%, #ede9fe 100%);
        }

        .info-item.box-dep {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #ffffff 0%, #fee2e2 100%);
        }

        .info-item.box-area {
            border-left-color: #14b8a6;
            background: linear-gradient(135deg, #ffffff 0%, #ccfbf1 100%);
        }

        .info-item.box-position {
            border-left-color: #f97316;
            background: linear-gradient(135deg, #ffffff 0%, #ffedd5 100%);
        }

        .info-item.box-shift {
            border-left-color: #a855f7;
            background: linear-gradient(135deg, #ffffff 0%, #f3e8ff 100%);
        }

        .item-icon {
            font-size: 2em;
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .item-label {
            font-size: 0.85em;
            color: #64748b;
            margin-bottom: 6px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .item-value {
            font-size: 1.15em;
            color: #1e293b;
            font-weight: 600;
        }

        .card-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px dashed #cbd5e1;
        }

        .action-button {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            font-family: 'Kanit', sans-serif;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .btn-delete {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-delete:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        /* Rest of the existing styles... */
        .scan-section {
            text-align: center;
        }

        #scanInput {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #667eea;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-family: 'Kanit', sans-serif;
        }

        #scanInput:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .scan-icon {
            font-size: 5em;
            margin: 20px 0;
        }

        .result-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        .result-box.error {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        .result-box.duplicate {
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-box.show {
            display: block;
        }

        .result-item {
            margin: 10px 0;
            font-size: 1.2em;
        }

        .result-item strong {
            display: inline-block;
            width: 150px;
        }

        .duplicate-warning {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 1.1em;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .manual-input-section {
            background: #fff3cd;
            border: 3px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .manual-input-section.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        .manual-input-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .manual-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #manualInput {
            flex: 1;
            padding: 12px;
            font-size: 1.1em;
            border: 2px solid #ffc107;
            border-radius: 8px;
            font-family: 'Kanit', sans-serif;
        }

        .upload-area {
            border: 3px dashed #667eea;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            position: relative;
        }

        .upload-area:hover {
            background: #f0f4ff;
            border-color: #764ba2;
            transform: translateY(-2px);
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .upload-area h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .upload-area p {
            color: #666;
            margin-top: 10px;
            line-height: 1.6;
        }

        input[type="file"] {
            display: none;
        }

        .saved-databases {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .saved-databases h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .database-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .database-item:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .database-item.active {
            border-color: #38ef7d;
            background: #f0fff4;
        }

        .database-info {
            flex: 1;
        }

        .database-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 3px;
        }

        .database-count {
            font-size: 0.9em;
            color: #666;
        }

        .database-actions {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.9em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-family: 'Kanit', sans-serif;
        }

        .btn-load {
            background: #667eea;
            color: white;
        }

        .btn-load:hover {
            background: #5568d3;
        }

        .btn-delete {
            background: #ff6b6b;
            color: white;
        }

        .btn-delete:hover {
            background: #ee5a6f;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-family: 'Kanit', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            width: 100%;
            margin-top: 10px;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(56, 239, 125, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 12px 25px;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            padding: 12px 25px;
        }

        .btn-info {
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            color: white;
            width: 100%;
            margin-top: 10px;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(58, 123, 213, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            width: 100%;
            margin-top: 10px;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(238, 90, 111, 0.4);
        }

        .data-table {
            width: 100%;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f0f4ff;
        }

        tr.duplicate-row {
            background: #fff3cd;
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .status-success {
            background: #38ef7d;
            color: white;
        }

        .status-manual {
            background: #ffc107;
            color: #000;
        }

        .status-duplicate {
            background: #ff9800;
            color: white;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
            font-family: 'Kanit', sans-serif;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .notification.show {
            display: block;
        }

        .notification.success {
            border-left: 5px solid #38ef7d;
        }

        .notification.error {
            border-left: 5px solid #ff6b6b;
        }

        .notification.warning {
            border-left: 5px solid #ffc107;
        }

        .notification.duplicate {
            border-left: 5px solid #ff9800;
        }

        .bad-id-warning {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            color: #856404;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .button-group-three {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: #999;
            font-style: italic;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .modal-icon {
            font-size: 3em;
        }

        .modal-header h3 {
            color: #667eea;
            font-size: 1.5em;
        }

        .modal-body {
            margin: 20px 0;
        }

        .clear-option {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .clear-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .clear-option input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .clear-option label {
            cursor: pointer;
            font-weight: bold;
            color: #333;
        }

        .clear-option p {
            margin-top: 5px;
            margin-left: 28px;
            font-size: 0.9em;
            color: #666;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-footer button {
            flex: 1;
        }

        @media (max-width: 768px) {
            .main-section {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr 1fr;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .manual-input-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .button-group, .button-group-three {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .card-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                üì± ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </h1>
            <p>‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ - Export Excel</p>
        </div>

        <!-- Main Section -->
        <div class="main-section">
            <!-- Scan Section -->
            <div class="card scan-section">
                <h2>üîç ‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç</h2>
                <div class="scan-icon">üì∑</div>
                <input type="text" id="scanInput" placeholder="‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." autofocus>
                <p style="color: #666; margin-top: 10px;">
                    üí° ‡∏ß‡∏≤‡∏á‡πÄ‡∏Ñ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏•‡∏¢
                </p>

                <!-- Result Box -->
                <div class="result-box" id="resultBox">
                    <div class="result-item">
                        <strong>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:</strong>
                        <span id="resultEmpId">-</span>
                    </div>
                    <div class="result-item">
                        <strong>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</strong>
                        <span id="resultName">-</span>
                    </div>
                    <div class="result-item">
                        <strong>BAD ID:</strong>
                        <span id="resultBadId">-</span>
                    </div>
                    <div class="result-item">
                        <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô:</strong>
                        <span id="resultDate">-</span>
                    </div>
                    <div class="result-item">
                        <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong>
                        <span id="resultTime">-</span>
                    </div>
                    <div class="duplicate-warning" id="duplicateWarning" style="display: none;">
                        ‚ö†Ô∏è ‡∏ã‡πâ‡∏≥! ‡πÄ‡∏Ñ‡∏¢‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠ <span id="previousScanTime">-</span>
                    </div>
                </div>

                <!-- Manual Input Section -->
                <div class="manual-input-section" id="manualInputSection">
                    <h3>‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</h3>
                    <div class="bad-id-warning">
                        <strong>BAD ID ‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô:</strong> <span id="badIdScanned">-</span>
                    </div>
                    <div class="manual-input-group">
                        <input type="text" id="manualInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 10 ‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏ä‡πà‡∏ô 1000336245)">
                        <button class="btn btn-warning" onclick="submitManualInput()">‚úì ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                        <button class="btn btn-secondary" onclick="cancelManualInput()">‚úï ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            </div>

            <!-- Upload Section -->
            <div class="card">
                <h2>üì§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                
                <!-- Saved Databases -->
                <div class="saved-databases" id="savedDatabasesContainer">
                    <h4>üíæ ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</h4>
                    <div id="savedDatabasesList">
                        <div class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</div>
                    </div>
                </div>

                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">üìÅ</div>
                    <h3>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel</h3>
                    <p>
                        ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå .xlsx ‡πÅ‡∏•‡∏∞ .xls<br>
                        (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå: <strong>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô, ‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•, BAD ID</strong>)
                    </p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls">
                </div>
                <div id="uploadStatus" style="text-align: center; color: #667eea; font-weight: bold; margin-bottom: 15px;"></div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="downloadTemplate()">
                        üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                    </button>
                    <button class="btn btn-primary" onclick="loadSampleData()">
                        üìã ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                    </button>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-info" onclick="saveCurrentDatabase()" id="saveDbBtn" style="display: none;">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                    </button>
                    <button class="btn btn-danger" onclick="showClearDataModal()">
                        üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="card">
            <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalScans">0</div>
                    <div class="stat-label">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥)</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-number" id="duplicateScans">0</div>
                    <div class="stat-label">‡∏™‡πÅ‡∏Å‡∏ô‡∏ã‡πâ‡∏≥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="databaseCount">0</div>
                    <div class="stat-label">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayScans">0</div>
                    <div class="stat-label">‡∏™‡πÅ‡∏Å‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                </div>
            </div>
        </div>

        <!-- Employee Cards Section -->
        <div class="card">
            <h2>üë• ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô</h2>
            <div class="employee-cards-section" id="employeeCardsContainer">
                <div class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏•‡∏¢!</div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="card">
            <h2>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô (‡∏™‡∏£‡∏∏‡∏õ)</h2>
            <div class="button-group-three">
                <button class="btn btn-success" onclick="exportToExcel()">
                    üìä Export Excel
                </button>
                <button class="btn btn-primary" onclick="exportScannedRecords()">
                    üì• Export ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
                </button>
                <button class="btn btn-danger" onclick="clearScannedRecordsOnly()">
                    üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
                </button>
            </div>
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                            <th>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                            <th>BAD ID</th>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏•‡∏¢!
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Clear Data Modal -->
    <div class="modal" id="clearDataModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">üóëÔ∏è</div>
                <h3>‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: #666;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á:</p>
                
                <div class="clear-option" onclick="toggleCheckbox('clearScanned')">
                    <input type="checkbox" id="clearScanned" checked>
                    <label for="clearScanned">‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô</label>
                    <p>‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏ã‡πâ‡∏≥)</p>
                </div>

                <div class="clear-option" onclick="toggleCheckbox('clearDatabase')">
                    <input type="checkbox" id="clearDatabase">
                    <label for="clearDatabase">‡∏•‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                    <p>‡∏•‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                </div>

                <div class="clear-option" onclick="toggleCheckbox('clearSavedDb')">
                    <input type="checkbox" id="clearSavedDb">
                    <label for="clearSavedDb">‡∏•‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</label>
                    <p>‡∏•‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </div>

                <div class="clear-option" onclick="toggleCheckbox('clearAll')">
                    <input type="checkbox" id="clearAll">
                    <label for="clearAll">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</label>
                    <p style="color: #d32f2f; font-weight: bold;">‚ö†Ô∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ)</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeClearDataModal()" style="width: auto;">
                    ‚úï ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
                <button class="btn btn-danger" onclick="confirmClearData()" style="width: auto;">
                    üóëÔ∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // Global Variables
        let database = [];
        let scannedRecords = [];
        let duplicateScans = [];
        let currentBadId = '';
        let savedDatabases = [];
        let currentDatabaseName = '';

        // Sample Data with all fields
        const sampleData = [
            { empId: '1000333210', name: '‡∏™‡∏Å‡∏±‡∏ç‡∏ç‡∏≤ ‡∏®‡∏£‡∏µ‡∏õ‡∏£‡∏∞‡πÑ‡∏´‡∏°', badId: '1000333210', batch: '‡∏£‡∏∏‡πà‡∏ô 10', phone: '0803917333', dep: 'HDA', area: 'Cleaning', position: 'PART RECEIVING', shift: 'D / E' },
            { empId: '1000333203', name: '‡∏™‡∏£‡∏±‡∏ç‡∏ç‡∏≤ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏®‡∏¥‡∏•‡∏õ', badId: '1000333203', batch: '‡∏£‡∏∏‡πà‡∏ô 10', phone: '0982374272', dep: 'HDA', area: 'Cleaning', position: 'PART RECEIVING', shift: 'D / E' },
            { empId: '1000333301', name: '‡∏Ñ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏ì ‡∏à‡∏¥‡∏ï‡∏ï‡πå‡∏≠‡∏≤‡∏£‡∏µ‡∏¢‡πå', badId: '1000333301', batch: '‡∏£‡∏∏‡πà‡∏ô 10', phone: '0925511437', dep: 'HDA', area: 'Cleaning', position: 'PART RECEIVING', shift: 'D / E' }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            loadSavedDatabases();
            updateStats();
            updateSavedDatabasesList();
            updateEmployeeCards();
            
            // Setup file input
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
            
            // Setup scan input
            const scanInput = document.getElementById('scanInput');
            scanInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    processScan(scanInput.value.trim());
                }
            });

            // Setup manual input
            const manualInput = document.getElementById('manualInput');
            manualInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitManualInput();
                }
            });

            // Clear all checkbox handler
            document.getElementById('clearAll').addEventListener('change', function(e) {
                if (e.target.checked) {
                    document.getElementById('clearScanned').checked = true;
                    document.getElementById('clearDatabase').checked = true;
                    document.getElementById('clearSavedDb').checked = true;
                }
            });
        });

        // Toggle checkbox when clicking on div
        function toggleCheckbox(id) {
            const checkbox = document.getElementById(id);
            checkbox.checked = !checkbox.checked;
            
            // Handle "clear all" logic
            if (id !== 'clearAll' && !checkbox.checked) {
                document.getElementById('clearAll').checked = false;
            }
        }

        // Show clear data modal
        function showClearDataModal() {
            document.getElementById('clearDataModal').classList.add('show');
        }

        // Close clear data modal
        function closeClearDataModal() {
            document.getElementById('clearDataModal').classList.remove('show');
            // Reset checkboxes
            document.getElementById('clearScanned').checked = true;
            document.getElementById('clearDatabase').checked = false;
            document.getElementById('clearSavedDb').checked = false;
            document.getElementById('clearAll').checked = false;
        }

        // Confirm clear data
        function confirmClearData() {
            const clearScanned = document.getElementById('clearScanned').checked;
            const clearDatabase = document.getElementById('clearDatabase').checked;
            const clearSavedDb = document.getElementById('clearSavedDb').checked;
            const clearAll = document.getElementById('clearAll').checked;

            if (!clearScanned && !clearDatabase && !clearSavedDb && !clearAll) {
                showNotification('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á', 'warning');
                return;
            }

            let message = '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á';
            const items = [];
            if (clearScanned) items.push('‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô');
            if (clearDatabase) items.push('‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô');
            if (clearSavedDb) items.push('‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ');
            if (clearAll) items.push('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î');
            
            message += items.join(', ') + ' ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ';

            if (!confirm(message)) return;

            // Clear selected data
            if (clearScanned || clearAll) {
                scannedRecords = [];
                duplicateScans = [];
            }

            if (clearDatabase || clearAll) {
                database = [];
                currentDatabaseName = '';
                document.getElementById('uploadStatus').innerHTML = '';
            }

            if (clearSavedDb || clearAll) {
                savedDatabases = [];
                localStorage.removeItem('savedDatabases');
            }

            // Save and update
            saveToLocalStorage();
            updateStats();
            updateTable();
            updateSavedDatabasesList();
            updateEmployeeCards();
            closeClearDataModal();

            showNotification('‚úÖ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Clear scanned records only (quick button)
        function clearScannedRecordsOnly() {
            if (scannedRecords.length === 0 && duplicateScans.length === 0) {
                showNotification('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤‡∏á', 'warning');
                return;
            }

            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n(‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà)')) return;

            scannedRecords = [];
            duplicateScans = [];
            saveToLocalStorage();
            updateStats();
            updateTable();
            updateEmployeeCards();

            showNotification('‚úÖ ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Export scanned records
        function exportScannedRecords() {
            if (scannedRecords.length === 0) {
                showNotification('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ Export', 'warning');
                return;
            }
            exportToExcel();
        }

        // Save current database
        function saveCurrentDatabase() {
            if (database.length === 0) {
                showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
                return;
            }

            const dbName = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', currentDatabaseName || '‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ' + new Date().toLocaleDateString('th-TH'));
            
            if (!dbName) return;

            const dbId = Date.now().toString();
            const newDatabase = {
                id: dbId,
                name: dbName,
                data: [...database],
                count: database.length,
                savedDate: new Date().toLocaleString('th-TH')
            };

            // Check if name exists
            const existingIndex = savedDatabases.findIndex(db => db.name === dbName);
            if (existingIndex >= 0) {
                if (confirm('‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    savedDatabases[existingIndex] = newDatabase;
                } else {
                    return;
                }
            } else {
                savedDatabases.push(newDatabase);
            }

            currentDatabaseName = dbName;
            localStorage.setItem('savedDatabases', JSON.stringify(savedDatabases));
            updateSavedDatabasesList();
            showNotification('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Load saved database
        function loadSavedDatabase(dbId) {
            const db = savedDatabases.find(d => d.id === dbId);
            if (!db) return;

            database = [...db.data];
            currentDatabaseName = db.name;
            saveToLocalStorage();
            updateStats();
            updateSavedDatabasesList();
            
            document.getElementById('uploadStatus').innerHTML = 
                `‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "<strong>${db.name}</strong>" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${db.count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            
            showNotification('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Delete saved database
        function deleteSavedDatabase(dbId) {
            const db = savedDatabases.find(d => d.id === dbId);
            if (!db) return;

            if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "${db.name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;

            savedDatabases = savedDatabases.filter(d => d.id !== dbId);
            localStorage.setItem('savedDatabases', JSON.stringify(savedDatabases));
            updateSavedDatabasesList();
            showNotification('‚úÖ ‡∏•‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Update saved databases list
        function updateSavedDatabasesList() {
            const container = document.getElementById('savedDatabasesList');
            const saveBtn = document.getElementById('saveDbBtn');
            
            // Show/hide save button
            saveBtn.style.display = database.length > 0 ? 'block' : 'none';

            if (savedDatabases.length === 0) {
                container.innerHTML = '<div class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</div>';
                return;
            }

            container.innerHTML = savedDatabases.map(db => `
                <div class="database-item ${currentDatabaseName === db.name ? 'active' : ''}">
                    <div class="database-info">
                        <div class="database-name">${db.name}</div>
                        <div class="database-count">${db.count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‚Ä¢ ${db.savedDate}</div>
                    </div>
                    <div class="database-actions">
                        <button class="btn-small btn-load" onclick="loadSavedDatabase('${db.id}')">‡πÇ‡∏´‡∏•‡∏î</button>
                        <button class="btn-small btn-delete" onclick="deleteSavedDatabase('${db.id}')">‡∏•‡∏ö</button>
                    </div>
                </div>
            `).join('');
        }

        // Load saved databases from localStorage
        function loadSavedDatabases() {
            const saved = localStorage.getItem('savedDatabases');
            if (saved) {
                savedDatabases = JSON.parse(saved);
            }
        }

        // Load sample data
        function loadSampleData() {
            database = [...sampleData];
            currentDatabaseName = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á';
            saveToLocalStorage();
            updateStats();
            updateSavedDatabasesList();
            
            document.getElementById('uploadStatus').innerHTML = 
                `‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: <strong>${database.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</strong>`;
            
            showNotification('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Process scan
        function processScan(scannedId) {
            if (!scannedId) return;

            const scanInput = document.getElementById('scanInput');
            currentBadId = scannedId;

            // Hide previous results
            document.getElementById('resultBox').classList.remove('show');
            document.getElementById('manualInputSection').classList.remove('show');

            // Try to find by employee ID first
            let person = database.find(p => p.empId === scannedId);
            
            // If not found, try to find by BAD ID
            if (!person) {
                person = database.find(p => p.badId === scannedId);
            }

            if (!person) {
                // Show manual input section
                showManualInput(scannedId);
                scanInput.value = '';
                return;
            }

            // Check for duplicate (same employee ID scanned today)
            const today = new Date().toLocaleDateString('th-TH');
            const existingRecord = scannedRecords.find(r => 
                r.empId === person.empId && r.date === today
            );

            if (existingRecord) {
                // Duplicate scan - show but don't count
                showDuplicateResult(person, existingRecord);
                
                // Add to duplicate list
                const now = new Date();
                duplicateScans.push({
                    ...person,
                    date: now.toLocaleDateString('th-TH'),
                    time: now.toLocaleTimeString('th-TH'),
                    timestamp: now.getTime()
                });
                
                saveToLocalStorage();
                updateStats();
            } else {
                // New scan - create record
                createRecord(person, 'auto');
            }

            scanInput.value = '';
            
            // Refocus input
            setTimeout(() => scanInput.focus(), 100);
        }

        // Show duplicate result
        function showDuplicateResult(person, existingRecord) {
            document.getElementById('resultEmpId').textContent = person.empId;
            document.getElementById('resultName').textContent = person.name;
            document.getElementById('resultBadId').textContent = person.badId;
            
            const now = new Date();
            document.getElementById('resultDate').textContent = now.toLocaleDateString('th-TH');
            document.getElementById('resultTime').textContent = now.toLocaleTimeString('th-TH');
            
            // Show duplicate warning
            document.getElementById('previousScanTime').textContent = 
                `${existingRecord.date} ‡πÄ‡∏ß‡∏•‡∏≤ ${existingRecord.time}`;
            document.getElementById('duplicateWarning').style.display = 'block';
            
            const resultBox = document.getElementById('resultBox');
            resultBox.classList.remove('error');
            resultBox.classList.add('duplicate');
            resultBox.classList.remove('show');
            setTimeout(() => resultBox.classList.add('show'), 10);

            showNotification(`‚ö†Ô∏è ‡∏ã‡πâ‡∏≥! ${person.name} ‡πÄ‡∏Ñ‡∏¢‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡πâ‡∏ß`, 'duplicate');
        }

        // Show manual input
        function showManualInput(badId) {
            document.getElementById('badIdScanned').textContent = badId;
            document.getElementById('manualInputSection').classList.add('show');
            document.getElementById('manualInput').value = '';
            document.getElementById('manualInput').focus();
            
            showNotification('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', 'warning');
        }

        // Submit manual input
        function submitManualInput() {
            const manualEmpId = document.getElementById('manualInput').value.trim();
            
            if (!manualEmpId) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', 'error');
                return;
            }

            // Find person by employee ID
            const person = database.find(p => p.empId === manualEmpId);
            
            if (!person) {
                showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'error');
                return;
            }

            // Check for duplicate
            const today = new Date().toLocaleDateString('th-TH');
            const existingRecord = scannedRecords.find(r => 
                r.empId === person.empId && r.date === today
            );

            if (existingRecord) {
                // Duplicate scan
                showDuplicateResult(person, existingRecord);
                
                // Add to duplicate list
                const now = new Date();
                duplicateScans.push({
                    ...person,
                    badId: currentBadId,
                    date: now.toLocaleDateString('th-TH'),
                    time: now.toLocaleTimeString('th-TH'),
                    timestamp: now.getTime()
                });
                
                saveToLocalStorage();
                updateStats();
            } else {
                // Create record with manual entry
                createRecord({...person, badId: currentBadId}, 'manual');
            }
            
            // Hide manual input section
            document.getElementById('manualInputSection').classList.remove('show');
            
            // Refocus scan input
            document.getElementById('scanInput').focus();
        }

        // Cancel manual input
        function cancelManualInput() {
            document.getElementById('manualInputSection').classList.remove('show');
            document.getElementById('scanInput').focus();
            currentBadId = '';
        }

        // Create record
        function createRecord(person, type) {
            const now = new Date();
            const date = now.toLocaleDateString('th-TH');
            const time = now.toLocaleTimeString('th-TH');

            const record = {
                ...person,
                date: date,
                time: time,
                timestamp: now.getTime(),
                type: type // 'auto' or 'manual'
            };

            // Add to records
            scannedRecords.unshift(record);
            
            // Save to localStorage
            saveToLocalStorage();

            // Show result
            showResult(record);

            // Update table
            updateTable();
            
            // Update employee cards
            updateEmployeeCards();

            // Update stats
            updateStats();

            // Show notification
            const message = type === 'manual' 
                ? '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Manual): ' + record.name
                : '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + record.name;
            showNotification(message, 'success');
        }

        // Show result
        function showResult(record) {
            document.getElementById('resultEmpId').textContent = record.empId;
            document.getElementById('resultName').textContent = record.name;
            document.getElementById('resultBadId').textContent = record.badId;
            document.getElementById('resultDate').textContent = record.date;
            document.getElementById('resultTime').textContent = record.time;
            
            // Hide duplicate warning
            document.getElementById('duplicateWarning').style.display = 'none';
            
            const resultBox = document.getElementById('resultBox');
            resultBox.classList.remove('error');
            resultBox.classList.remove('duplicate');
            resultBox.classList.remove('show');
            setTimeout(() => resultBox.classList.add('show'), 10);
        }

        // Update employee cards
        function updateEmployeeCards() {
            const container = document.getElementById('employeeCardsContainer');
            
            if (scannedRecords.length === 0) {
                container.innerHTML = '<div class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏•‡∏¢!</div>';
                return;
            }

            container.innerHTML = scannedRecords.map((record, index) => `
                <div class="employee-card-item">
                    <div class="card-badge">${index + 1}</div>
                    
                    <div class="info-grid">
                        <div class="info-item box-empid">
                            <div class="item-icon">üÜî</div>
                            <div class="item-label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
                            <div class="item-value">${record.empId || '-'}</div>
                        </div>
                        
                        <div class="info-item box-badid">
                            <div class="item-icon">üí≥</div>
                            <div class="item-label">Bad ID</div>
                            <div class="item-value">${record.badId || '-'}</div>
                        </div>
                        
                        <div class="info-item box-name">
                            <div class="item-icon">üë§</div>
                            <div class="item-label">‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</div>
                            <div class="item-value">${record.name || '-'}</div>
                        </div>
                        
                        <div class="info-item box-batch">
                            <div class="item-icon">üìÖ</div>
                            <div class="item-label">‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</div>
                            <div class="item-value">${record.batch || '-'}</div>
                        </div>
                        
                        <div class="info-item box-phone">
                            <div class="item-icon">üì±</div>
                            <div class="item-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</div>
                            <div class="item-value">${record.phone || '-'}</div>
                        </div>
                        
                        <div class="info-item box-dep">
                            <div class="item-icon">üè¢</div>
                            <div class="item-label">Department</div>
                            <div class="item-value">${record.dep || '-'}</div>
                        </div>
                        
                        <div class="info-item box-area">
                            <div class="item-icon">üìç</div>
                            <div class="item-label">Area</div>
                            <div class="item-value">${record.area || '-'}</div>
                        </div>
                        
                        <div class="info-item box-position">
                            <div class="item-icon">üíº</div>
                            <div class="item-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô</div>
                            <div class="item-value">${record.position || '-'}</div>
                        </div>
                        
                        <div class="info-item box-shift">
                            <div class="item-icon">‚è∞</div>
                            <div class="item-label">‡∏Å‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>
                            <div class="item-value">${record.shift || '-'}</div>
                        </div>
                    </div>
                    
                    <div class="card-actions">
                        <button class="action-button btn-delete" onclick="deleteRecord(${index})">
                            üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Delete record
        function deleteRecord(index) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                scannedRecords.splice(index, 1);
                saveToLocalStorage();
                updateStats();
                updateTable();
                updateEmployeeCards();
                showNotification('‚úÖ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            }
        }

        // Handle file upload
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    // Process data with all fields
                    database = jsonData.map(row => ({
                        empId: String(row['‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'] || row['‡∏£‡∏´‡∏±‡∏™'] || row['ID'] || '').trim(),
                        name: String(row['‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] || row['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] || row['Name'] || '').trim(),
                        badId: String(row['BAD ID'] || row['BadID'] || row['BADID'] || row['Bad ID'] || '').trim(),
                        batch: String(row['‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô'] || row['‡∏£‡∏∏‡πà‡∏ô'] || row['Batch'] || '').trim(),
                        phone: String(row['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå'] || row['‡πÄ‡∏ö‡∏≠‡∏£‡πå'] || row['Phone'] || '').trim(),
                        dep: String(row['Dep.'] || row['Department'] || row['‡πÅ‡∏ú‡∏ô‡∏Å'] || '').trim(),
                        area: String(row['Area'] || row['‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà'] || '').trim(),
                        position: String(row['‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô'] || row['Position'] || '').trim(),
                        shift: String(row['‡∏Å‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô'] || row['‡∏Å‡∏∞'] || row['Shift'] || '').trim()
                    })).filter(item => item.empId && item.name);

                    currentDatabaseName = file.name.replace(/\.[^/.]+$/, '');
                    saveToLocalStorage();
                    updateStats();
                    updateSavedDatabasesList();
                    
                    document.getElementById('uploadStatus').innerHTML = 
                        `‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: <strong>${database.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</strong>`;
                    
                    showNotification('‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                } catch (error) {
                    console.error('Error:', error);
                    showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Update table
        function updateTable() {
            const tbody = document.getElementById('dataTableBody');
            
            if (scannedRecords.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏•‡∏¢!
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = scannedRecords.map((record, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${record.empId}</td>
                    <td>${record.name}</td>
                    <td>${record.badId}</td>
                    <td>${record.date}</td>
                    <td>${record.time}</td>
                    <td>
                        <span class="status-badge ${record.type === 'manual' ? 'status-manual' : 'status-success'}">
                            ${record.type === 'manual' ? '‚úé Manual' : '‚úì Auto'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalScans').textContent = scannedRecords.length;
            document.getElementById('duplicateScans').textContent = duplicateScans.length;
            document.getElementById('databaseCount').textContent = database.length;
            
            const today = new Date().toLocaleDateString('th-TH');
            const todayScans = scannedRecords.filter(r => r.date === today).length;
            document.getElementById('todayScans').textContent = todayScans;
        }

        // Export to Excel
        function exportToExcel() {
            if (scannedRecords.length === 0) {
                showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ Export', 'error');
                return;
            }

            const exportData = scannedRecords.map((record, index) => ({
                '‡∏•‡∏≥‡∏î‡∏±‡∏ö': index + 1,
                '‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô': record.empId,
                '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•': record.name,
                'BAD ID': record.badId,
                '‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô': record.batch || '-',
                '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå': record.phone || '-',
                'Dep.': record.dep || '-',
                'Area': record.area || '-',
                '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô': record.position || '-',
                '‡∏Å‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô': record.shift || '-',
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà': record.date,
                '‡πÄ‡∏ß‡∏•‡∏≤': record.time,
                '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': record.type === 'manual' ? 'Manual Input' : 'Auto Scan'
            }));

            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô");

            ws['!cols'] = [
                { wch: 8 }, { wch: 15 }, { wch: 25 }, { wch: 15 }, 
                { wch: 12 }, { wch: 15 }, { wch: 10 }, { wch: 12 },
                { wch: 20 }, { wch: 10 }, { wch: 15 }, { wch: 12 }, { wch: 15 }
            ];

            const fileName = `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô_${new Date().toLocaleDateString('th-TH').replace(/\//g, '-')}.xlsx`;
            XLSX.writeFile(wb, fileName);

            showNotification('‚úÖ Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Download template
        function downloadTemplate() {
            const ws = XLSX.utils.json_to_sheet(sampleData.map(item => ({
                '‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô': item.empId,
                '‡∏ä‡∏∑‡πà‡∏≠ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•': item.name,
                'BAD ID': item.badId,
                '‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô': item.batch,
                '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå': item.phone,
                'Dep.': item.dep,
                'Area': item.area,
                '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô': item.position,
                '‡∏Å‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô': item.shift
            })));
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");

            ws['!cols'] = [
                { wch: 15 }, { wch: 25 }, { wch: 15 }, { wch: 12 },
                { wch: 15 }, { wch: 10 }, { wch: 12 }, { wch: 20 }, { wch: 10 }
            ];

            XLSX.writeFile(wb, '‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•.xlsx');
            showNotification('‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Local Storage
        function saveToLocalStorage() {
            localStorage.setItem('database', JSON.stringify(database));
            localStorage.setItem('currentDatabaseName', currentDatabaseName);
            localStorage.setItem('scannedRecords', JSON.stringify(scannedRecords));
            localStorage.setItem('duplicateScans', JSON.stringify(duplicateScans));
        }

        function loadFromLocalStorage() {
            const savedDatabase = localStorage.getItem('database');
            const savedDbName = localStorage.getItem('currentDatabaseName');
            const savedRecords = localStorage.getItem('scannedRecords');
            const savedDuplicates = localStorage.getItem('duplicateScans');
            
            if (savedDatabase) {
                database = JSON.parse(savedDatabase);
            }

            if (savedDbName) {
                currentDatabaseName = savedDbName;
            }
            
            if (savedRecords) {
                scannedRecords = JSON.parse(savedRecords);
                updateTable();
            }

            if (savedDuplicates) {
                duplicateScans = JSON.parse(savedDuplicates);
            }
        }
    </script>
</body>
</html>
